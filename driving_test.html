<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×˜×•×¤×¡ ××‘×—×Ÿ × ×”×™×’×” - ×¦×”"×œ - ××©×¨×“ ×”×¨×™×©×•×™</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f4f4; padding: 20px; direction: rtl; }
        
        /* ××™×›×œ ×”×˜×•×¤×¡ */
        .form-container { 
            max-width: 1100px; margin: auto; background: white; padding: 30px; 
            border: 2px solid #000; box-shadow: 0 0 10px rgba(0,0,0,0.1); 
        }
        
        .header { text-align: center; border-bottom: 2px solid #000; margin-bottom: 10px; padding-bottom: 5px; }
        .header h1 { margin: 0; font-size: 24px; color: #1a3a1a; }
        .header h2 { margin: 2px 0; font-size: 18px; }

        .top-info { display: grid; grid-template-columns: 1.5fr 1fr; gap: 15px; margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .vehicle-types { font-size: 12px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; border: 1px solid #ccc; padding: 5px; background: #f9f9f9; }
        
        .details-section { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 15px; background: #fdfdfd; padding: 5px; border: 1px solid #eee; }
        .field { display: flex; flex-direction: column; gap: 2px; }
        .field label { font-weight: bold; font-size: 11px; color: #555; }
        input[type="text"], input[type="date"], input[type="time"] { 
            border: 1px solid #ccc; border-radius: 3px; width: 100%; padding: 4px; 
            font-family: inherit; font-size: 13px; font-weight: bold; background: #fff;
        }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0; border: 2px solid #000; }
        .column { border: 0.5px solid #000; display: flex; flex-direction: column; }
        .column-title { background: #333; color: #fff; font-weight: bold; text-align: center; padding: 5px; border-bottom: 2px solid #000; font-size: 14px; }
        
        .row-item { display: flex; align-items: center; border-bottom: 1px solid #ccc; padding: 2px 5px; min-height: 28px; page-break-inside: avoid; flex-wrap: wrap; }
        .label-text { flex: 1; font-size: 12px; font-weight: 500; line-height: 1.1; min-width: 120px; }
        
        .score-select { width: 60px; font-size: 11px; margin-left: 5px; border: 1px solid #ccc; cursor: pointer; height: 22px; }
        
        /* ×¡×œ×§×˜ ×”× ×™××•×§×™× */
        .reason-select {
            display: none; 
            width: 100%; margin-top: 4px; font-size: 12px; font-weight: bold;
            color: #b00; border: 1px solid #ffcccc; background: #fff5f5; padding: 3px;
        }

        .visual-box { width: 22px; height: 22px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; background: #fff; margin-right: 5px; flex-shrink: 0; }
        .v-mark { color: green; }
        .x-mark { color: red; }
        .ox-mark { color: red; width: 16px; height: 16px; border: 2px solid red; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; }

        .footer { margin-top: 10px; display: flex; gap: 15px; }
        
        /* ×ª×™×‘×ª ×”×¢×¨×•×ª ××ª×¨×—×‘×ª */
        .notes-area { 
            flex: 2; 
            min-height: 80px; 
            border: 1px solid #000; 
            padding: 5px; 
            font-family: inherit; 
            resize: none; 
            font-size: 13px; 
            line-height: 1.4; 
            background: #fffff0; 
            overflow: hidden; 
            height: auto;
        }
        
        .summary-box { flex: 1; display: flex; flex-direction: column; justify-content: space-between; gap: 5px; }
        .fail-stamp { border: 3px solid red; color: red; padding: 2px 10px; text-align: center; font-size: 20px; font-weight: bold; transform: rotate(-3deg); align-self: center; }

        .digital-sig-box { text-align: center; border: 1px dashed #999; padding: 2px; background: #fff; }
        canvas { cursor: crosshair; display: block; margin: 0 auto; }
        .clear-btn { background: #eee; border: 1px solid #ccc; font-size: 10px; padding: 2px 5px; cursor: pointer; margin-top: 2px; width: 100%; }

        .bottom-actions { text-align: center; margin-top: 20px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .btn-action { padding: 12px 25px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; font-size: 16px; color: white; display: flex; align-items: center; gap: 5px; }
        .btn-print { background: #c00; }
        .btn-back { background: #555; }
        
        /* ×›×¤×ª×•×¨ ×•×•××˜×¡×¤ */
        .btn-whatsapp { background: #25D366; }
        .btn-whatsapp:hover { background: #128C7E; }

        @media print { 
            @page { size: A4 landscape; margin: 5mm; }
            body { padding: 0; background: white; margin: 0; -webkit-print-color-adjust: exact; } 
            .form-container { border: none; box-shadow: none; width: 100%; max-width: 100%; padding: 0; } 
            .no-print, .bottom-actions, .score-select, .clear-btn, .reason-select { display: none !important; } 
            .row-item { min-height: 20px; padding: 1px 4px; }
            .notes-area { border: 1px solid #000; overflow: visible; }
        }
    </style>
</head>
<body>

<div class="form-container">
    <div class="header">
        <h1>×¦×”"×œ - ××©×¨×“ ×”×¨×™×©×•×™</h1>
        <h2>×ª×•×¦××•×ª ××‘×—×Ÿ ××¢×©×™ ×‘×¨×›×‘ (× ×›×©×œ)</h2>
    </div>

    <div class="top-info">
        <div class="vehicle-types">
            <label><input type="checkbox"> ×¤×¨×˜×™/××¡×—×¨×™ (B)</label>
            <label><input type="checkbox"> ××©× ×§×œ (C1)</label>
            <label><input type="checkbox"> ××©× ×›×‘×“ (C)</label>
            <label><input type="checkbox"> ×’×•×¨×¨ ×ª×•××š (E)</label>
            <label><input type="checkbox"> ××•×˜×•×‘×•×¡ (D)</label>
            <label><input type="checkbox"> ××•×¤× ×•×¢ (A)</label>
            <label><input type="checkbox"> ××•× ×™×ª</label>
        </div>
        <div class="field" style="justify-content: center;">
            <label>×©× ×‘×™×ª ×”×¡×¤×¨ ×œ× ×”×™×’×”:</label>
            <input type="text" id="targetSchool">
        </div>
    </div>

    <div class="details-section">
        <div class="field"><label>×©× ××©×¤×—×”:</label><input type="text" id="targetLastName" oninput="updatePageTitle()"></div>
        <div class="field"><label>×©× ×¤×¨×˜×™:</label><input type="text" id="targetFirstName" oninput="updatePageTitle()"></div>
        <div class="field"><label>××¡' ××™×©×™ / ×ª"×–:</label><input type="text" id="targetID"></div>
        <div class="field"><label>×ª××¨×™×š ×”××‘×—×Ÿ:</label><input type="text" id="targetDate"></div>
        <div class="field"><label>×©×¢×ª ×”××‘×—×Ÿ:</label><input type="time" id="targetTime"></div>
        <div class="field"><label>××¡×¤×¨ ×¨×›×‘:</label><input type="text" id="targetCar"></div>
    </div>

    <div class="main-grid">
        <div class="column">
            <div class="column-title">×. ×©×œ×™×˜×” ×‘×¨×›×‘</div>
            <div id="colA"></div>
        </div>
        <div class="column">
            <div class="column-title">×‘. ×”×ª× ×•×¢×”</div>
            <div id="colB"></div>
        </div>
        <div class="column">
            <div class="column-title">×’. ×”×“×¨×š</div>
            <div id="colC"></div>
        </div>
    </div>

    <div class="footer">
        <textarea id="finalNotes" class="notes-area" placeholder="×”×¢×¨×•×ª ×”×‘×•×—×Ÿ ×™×•×¤×™×¢×• ×›××Ÿ ××•×˜×•××˜×™×ª..." oninput="autoResize(this)"></textarea>
        
        <div class="summary-box">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div class="fail-stamp">× ×›×©×œ</div>
                <div class="field" style="width: 60%;"><label>×©× ×”×‘×•×—×Ÿ:</label><input type="text" id="targetTester"></div>
            </div>
            
            <div class="digital-sig-box">
                <canvas id="sig-canvas" width="250" height="60"></canvas>
                <div class="no-print"><button class="clear-btn" onclick="clearSig()">× ×§×” ×—×ª×™××”</button></div>
                <div style="font-size:10px; font-weight:bold;">×—×ª×™××ª ×”×‘×•×—×Ÿ</div>
            </div>
        </div>
    </div>
    
    <div class="bottom-actions no-print">
        <button class="btn-action btn-whatsapp" onclick="sendWhatsApp()">
            <span style="font-size:20px">ğŸ“±</span> ×©×œ×— ×¡×™×›×•× ×‘×•×•××˜×¡×¤
        </button>
        <button class="btn-action btn-print" onclick="window.print()">×”×“×¤×¡ / ×©××•×¨ PDF</button>
        <button class="btn-action btn-back" onclick="window.close()">×¡×’×•×¨ ×•×—×–×•×¨</button>
    </div>
</div>

<script>
    // --- ×‘× ×§ ××©×¤×˜×™× ×—×›× ---
    const reasonsDB = {
        // --- ×¢××•×“×” ×' - ×©×œ×™×˜×” ---
        "1. ×”×ª×—×œ×ª × ×¡×™×¢×”": ["×“×™××•× ×× ×•×¢ ×—×•×–×¨ ×•× ×©× ×”", "×”×©×ª×”×•×ª ×™×ª×¨ ×‘×™×¦×™××” ××”××§×•×", "×”×ª×—×œ×ª × ×¡×™×¢×” ×§×•×¤×¦× ×™×ª/×—×•×¡×¨ ×¨×’×©"],
        "2. ×©×œ×™×˜×” ×‘×”×’×”": ["××—×™×–×ª ×”×’×” ×©×’×•×™×”/×¨×¤×•×™×”", "×—×•×¡×¨ ×™×¦×™×‘×•×ª ×‘× ×ª×™×‘ (×–×™×’×–×’)", "×¡×˜×™×™×” ×× ×ª×™×‘ ×œ×œ× ××™×ª×•×ª ××• ×¦×•×¨×š", "×ª×™×§×•× ×™ ×”×’×” ××•×’×–××™×"],
        "3. ×©×™××•×© ×‘××¦××“/×’×œ×™×©×”": ["×©×™××•×© ×™×ª×¨/××™×•×ª×¨ ×‘××¦××“", "×’×œ×™×©×” ××¡×•×›× ×ª ×œ×ª×•×š ×¦×•××ª", "×”×¢×œ××ª ×”×™×œ×•×š ×œ×œ× ×”×¤×¨×“×” (×—×¨×™×§×”)"],
        "4. ×”×—×œ×¤×ª ×”×™×œ×•×›×™× ×‘××•×¢×“": ["× ×¡×™×¢×” ×‘×”×™×œ×•×š ×œ× ××ª××™× ×œ××”×™×¨×•×ª", "××™×—×•×¨ ×‘×”×•×¨×“×ª ×”×™×œ×•×š ×‘×¢×œ×™×”/×¢×¦×™×¨×”", "×”×•×¨×“×ª ×¢×™× ×™×™× ×œ×™×“×™×ª ×”×”×™×œ×•×›×™×"],
        "5. ×–×™× ×•×§ ×‘×¢×œ×™×”": ["×–×™× ×•×§ ×‘×¢×œ×™×” - ×”×“×¨×“×¨×•×ª ×œ××—×•×¨ (×”×ª×¢×¨×‘×•×ª)", "×—×•×¡×¨ ×©×œ×™×˜×” ×‘× ×§×•×“×ª ×”×—×™×›×•×š", "×“×™××•× ×× ×•×¢ ×‘×–×™× ×•×§"],
        "6. ×©×™××•×© ×‘×‘×œ× ×¨×’×œ/×™×“": ["×‘×œ×™××” ×¤×ª××•××™×ª ×œ×œ× ×¦×•×¨×š", "×‘×œ×™××” ×××•×—×¨×ª ××™×“×™", "××™ ×©×—×¨×•×¨ ×‘×œ× ×™×“ ××œ×"],
        "7. ×©×œ×™×˜×” ×›×œ×œ×™×ª ×‘×¨×›×‘": ["×—×•×¡×¨ ×‘×™×˜×—×•×Ÿ ×‘×ª×¤×¢×•×œ ×”×¨×›×‘", "× ×”×™×’×” ××”×•×¡×¡×ª ×•××™×˜×™×ª ×œ×œ× ×¦×•×¨×š"],
        "8. ××™×ª×•×ª": ["××™ ××ª×Ÿ ××™×ª×•×ª ×‘×¤× ×™×•×ª/××¢×‘×¨ × ×ª×™×‘", "××™×ª×•×ª ×œ×¦×“ ×”×¤×•×š", "××™×ª×•×ª ×××•×—×¨ ××™×“×™"],
        "9. × ×¡×™×¢×” ×œ××—×•×¨ (×—× ×™×”)": [
            "×—× ×™×” ×‘××§×‘×™×œ ×œ×œ× ×”×¡×ª×›×œ×•×ª ×‘××¨××” ×”×©×××œ×™×ª",
            "×—× ×™×” ×‘× ×™×¦×‘ ×œ×œ× ×”×¡×ª×›×œ×•×ª ×‘××¨××” ×”×©×××œ×™×ª",
            "×¢×œ×™×” ×¢×œ ××“×¨×›×” ×‘××”×œ×š ×—× ×™×” ×œ××—×•×¨",
            "×—×•×¡×¨ ×”×ª××¦××•×ª ×‘××¨×—×‘/×™×•×ª×¨ ××™×“×™ ×ª×™×§×•× ×™×",
            "×¡×™×›×•×Ÿ ×¨×›×‘×™× ×—×•× ×™×/×¢×•×‘×¨×™ ×“×¨×š"
        ],
        "10. ×¢×¦×™×¨×ª ××˜×¨×”": ["×¢×¦×™×¨×” ×œ× ××“×•×™×§×ª ×‘×§×• ×¢×¦×™×¨×”", "×’×œ×™×©×” ××¢×‘×¨ ×œ×§×• ×”×¢×¦×™×¨×”"],
        "11. ×©×™××•×© ×‘×‘×œ××™ ×”××˜×”": ["××™ ×©×™××•×© ×‘×‘×œ× ×¢×–×¨ ×‘×™×¨×™×“×”"],
        "12. ××—×•×•× ×™× ×•××–×”×¨×”": ["×”×ª×¢×œ××•×ª ×× ×•×¨×•×ª ××–×”×¨×”"],
        "13. ××‘×™×–×¨×™ ×‘×˜×™×—×•×ª": ["××™ ×—×’×™×¨×ª ×—×’×•×¨×”", "××™ ×›×™×•×•×Ÿ ××¨××•×ª/××•×©×‘"],
        "14. × ×¡×™×¢×” ×œ××—×•×¨ ×‘×–×•×•×™×ª": ["×¡×˜×™×™×” ××”× ×ª×™×‘ ×‘× ×¡×™×¢×” ×œ××—×•×¨"],
        "15. ×”×ª×¨×ª ×•×¨×ª×™××ª ×’×¨×•×¨": ["×¡×“×¨ ×¤×¢×•×œ×•×ª ×©×’×•×™/×œ× ×‘×˜×™×—×•×ª×™"],

        // --- ×¢××•×“×” ×‘' - ×ª× ×•×¢×” ---
        "1. ×–×”×™×¨×•×ª": [
            "×¤× ×™×” ×‘×¦×•××ª ×§××¥ ×œ×œ× ×”××˜×” ×•×‘×“×™×§×” ××¡×¤×§×ª (×§×œ×•×ª ×¨××©)",
            "× ×”×™×’×” ×‘×—×•×¡×¨ ×–×”×™×¨×•×ª ×›×œ×œ×™", 
            "×—×•×¡×¨ ×ª×©×•××ª ×œ×‘ ×œ××ª×¨×—×© ×‘×“×¨×š"
        ],
        "2. ×”×¡×ª×›×œ×•×ª": [
            "×”× ×‘×—×Ÿ ××ª×§×¨×‘ ×œ××¢×’×œ ×•×™×•×¦× ×œ×œ× ×‘×“×™×§×” ×œ×™××™×Ÿ/××¨××•×ª",
            "×—×¦×™×™×ª ×¦××ª×™× ×œ×œ× ×‘×“×™×§×” ××•×§×“××ª ×‘×–×¨×•×¢×•×ª ×”×¦×•××ª",
            "××‘×˜ ××§×•×‘×¢ ×œ×¤× ×™×/××™ ×¡×¨×™×§×ª ×¦××ª×™×"
        ],
        "3. ×©×™××•×© ×‘××¨××•×ª": [
            "×¤× ×™×” ×™××™× ×” ×œ×œ× ×‘×“×™×§×ª ××¨××” ×™×× ×™×ª (×œ×¤× ×™/×‘××”×œ×š/××—×¨×™)",
            "××¢×‘×¨ ×œ× ×ª×™×‘ ×©×××œ ×œ×œ× ×‘×“×™×§×ª ××¨××” ×©×××œ×™×ª",
            "××™ ×©×™××•×© ×‘××¨××•×ª ×œ×¤× ×™ ×‘×œ×™××”/×¤× ×™×”"
        ],
        "4. ×”×©×ª×œ×‘×•×ª ×‘×ª× ×•×¢×”": [
            "×”× ×‘×—×Ÿ × ×™×¡×” ×œ×”×©×ª×œ×‘ ×œ××—×¨ ×¤× ×™×” ×™××™× ×” ×•×’×¨× ×œ×¨×›×‘ ×œ×”××˜/×œ×¡×˜×•×ª",
            "× ×™×¡×™×•×Ÿ ×œ×”×©×ª×œ×‘ ×‘×ª× ×•×¢×” ×‘×›×‘×™×© ×‘×™×Ÿ-×¢×™×¨×•× ×™ ×‘×¦×•×¨×” ××¡×•×›× ×ª",
            "×”×©×ª×œ×‘×•×ª ××¡×•×›× ×ª/×’×¨×™××ª ×”×¤×¨×¢×” ×œ×ª× ×•×¢×”",
            "× ×ª×™×‘ ××¡×ª×™×™× - ××™ ×‘×“×™×§×ª ××¨××•×ª ×•×”×©×ª×œ×‘×•×ª ×××•×—×¨×ª"
        ],
        "5. ××ª×Ÿ ×–×›×•×ª ×§×“×™××”": [
            "×”× ×‘×—×Ÿ ×œ× ××‘×—×™×Ÿ ×‘×ª× ×•×¢×” ××©×ª×œ×‘×ª ××™××™×Ÿ ×œ××—×¨ ×¤× ×™×” ×©×××œ×”",
            "××™ ××ª×Ÿ ×–×›×•×ª ×§×“×™××” ×œ×¨×›×‘ ×”×‘× ××™××™×Ÿ", 
            "×›× ×™×¡×” ×œ×¦×•××ª ×œ× ×¤× ×•×™"
        ],
        "6. ××”×™×¨×•×ª": ["× ×¡×™×¢×” ×‘××”×™×¨×•×ª ××•×¤×¨×–×ª ×œ×ª× ××™ ×”×“×¨×š", "× ×¡×™×¢×” ××™×˜×™×ª ××™×“×™ ×”××¢×›×‘×ª ×ª× ×•×¢×”"],
        "7. ×§×¦×‘ × ×¡×™×¢×”": ["×§×¦×‘ × ×¡×™×¢×” ××™×˜×™ ×‘×›×‘×™×© ×‘×™×Ÿ-×¢×™×¨×•× ×™", "×¢×™×›×•×‘ ×”×ª× ×•×¢×” ×©×œ× ×œ×¦×•×¨×š"],
        "8. ×©××™×¨×ª ×¨×•×•×—": ["×”×¦××“×•×ª ××¡×•×›× ×ª ×œ×¨×›×‘ ××œ×¤× ×™×", "××™ ×©××™×¨×ª ×¨×•×•×— ×¦×“"],
        "9. ××•××“×Ÿ ×¨×•×—×‘": [
            "×”×ª×§×¨×‘×•×ª ××¡×•×›× ×ª ×œ×¨×›×‘×™× ×—×•× ×™× ××™××™×Ÿ (×”×ª×¢×¨×‘×•×ª)",
            "× ×¡×™×¢×” ×§×¨×•×‘×” ××™×“×™ ×œ××“×¨×›×”"
        ],
        "10. ×¢×§×™×¤×•×ª/× ××§×£": [
            "×¢×§×™×¤×ª ×¨×›×‘ ×¢×•××“ ×œ×œ× ×‘×“×™×§×ª ××¨××” ×™×× ×™×ª ×‘×—×–×¨×”",
            "×œ× ×©× ×œ×‘ ×©× ×¢×§×£ ×•×œ× ××™×¤×©×¨ ×—×–×¨×” (×”××¦×”)",
            "×¢×§×™×¤×” ×‘×“×¨×š ×œ× ×¤× ×•×™×”/××¡×•×›× ×ª"
        ],
        "11. × ×”×™×’×ª ×œ×™×œ×”/××•×¨×•×ª": ["××™ ×”×“×œ×§×ª ××•×¨×•×ª/×¡×™× ×•×•×¨"],
        "12. ×™×¨×™×“×” ×œ×©×•×œ": ["×™×¨×™×“×” ××¡×•×›× ×ª ×œ×©×•×œ/×—×–×¨×” ×œ× ×–×”×™×¨×”"],

        // --- ×¢××•×“×” ×’' - ×”×“×¨×š ---
        "1. ×¤× ×™×•×ª ×™××™× ×”": [
            "×¤× ×™×” ×™××™× ×” ×‘×§×©×ª ×¨×—×‘×” ×•×’×œ×™×©×” ×œ× ×ª×™×‘ × ×’×“×™ (×”×ª×¢×¨×‘×•×ª)",
            "×¢×œ×™×” ×¢×œ ××“×¨×›×” ×‘×¤× ×™×” ×™××™× ×”",
            "×›× ×™×¡×” ×œ× ×ª×™×‘ ×œ× × ×›×•×Ÿ ×‘×¤× ×™×”"
        ],
        "2. ×¤× ×™×•×ª ×©×××œ×”": [
            "× ×™×¡×™×•×Ÿ ×¤× ×™×” ×©×××œ×” ×œ× ×ª×™×‘ ×”× ×’×“×™ (×”×ª×¢×¨×‘×•×ª)",
            "×¤× ×™×” ×©×××œ×” ×‘×§×©×ª ×§×¦×¨×” ××™×“×™ (×¡×™×›×•×Ÿ ××™ ×ª× ×•×¢×”/×ª××¨×•×¨)",
            "×¢×œ×™×” ×¢×œ ××™ ×ª× ×•×¢×” ×‘×¤× ×™×” ×©×××œ×”",
            "×¤× ×™×” ×©×××œ×” ×œ×—×“ ×¡×˜×¨×™ - ×œ× ×œ× ×ª×™×‘ ×”×©×××œ×™",
            "×¤× ×™×” ×©×××œ×” ××—×“ ×¡×˜×¨×™ - ×œ× ××”×¦×“ ×”×©×××œ×™",
            "× ×™×¡×™×•×Ÿ ×œ×¤× ×•×ª ×©×××œ×” ×× ×ª×™×‘ ×œ× × ×›×•×Ÿ"
        ],
        "3. ××™×§×•× ×‘××¤×’×©×™×": ["×¢××™×“×” ×‘××§×•× ×”××¤×¨×™×¢ ×œ×ª× ×•×¢×” ×‘×¦×•××ª"],
        "4. ××©××¢×ª ×‘× ×ª×™×‘×™×": ["×”× ×‘×—×Ÿ ×œ× ×—×•×–×¨ ×œ× ×ª×™×‘ ×”×™×× ×™ ×œ××—×¨ ×¤× ×™×”/×¢×§×™×¤×”", "×¡×˜×™×™×” ×× ×ª×™×‘ ×”× ×¡×™×¢×”", "× ×¡×™×¢×” ×¢×œ ×§×• ×”×”×¤×¨×“×”"],
        "5. ×¦×™×•×ª ×œ×ª××¨×•×¨×™×": ["××™ ×¢×¦×™×¨×” ×‘×ª××¨×•×¨ ×¢×¦×•×¨ (×”×ª×¢×¨×‘×•×ª)", "××™ ×¦×™×•×ª ×œ×ª××¨×•×¨ ××™×Ÿ ×›× ×™×¡×”/×—×¥"],
        "6. ×¦×™×•×ª ×œ×¨××–×•×¨×™×": ["× ×™×¡×™×•×Ÿ ×œ×¢×‘×•×¨ ×¦×•××ª ×‘××•×¨ ××“×•× (×”×ª×¢×¨×‘×•×ª)", "×¢×¦×™×¨×” ××—×¨×™ ×§×• ×¢×¦×™×¨×” ×‘×¨××–×•×¨"],
        "7. × ×¡×™×¢×” ×‘×™××™×Ÿ ×”×“×¨×š": ["××™ ×”×™×¦××“×•×ª ×œ×™××™×Ÿ ×‘×›×‘×™×© ×“×•-×¡×˜×¨×™", "× ×¡×™×¢×” ×‘×©×××œ ×œ×œ× ×¦×•×¨×š"],
        "8. ×“×¨×š ×©××™× ×” ×¢×™×¨×•× ×™×ª": ["× ×”×™×’×” ×œ× ××•×ª×××ª ×œ×“×¨×š ×‘×™×Ÿ-×¢×™×¨×•× ×™×ª"],
        "9. ×”×ª×™×™×—×¡×•×ª ×œ×”×•×œ×›×™ ×¨×’×œ": ["××™ ××ª×Ÿ ×–×›×•×ª ×§×“×™××” ×œ×”×•×œ×š ×¨×’×œ ×‘××¢×‘×¨ ×—×¦×™×” (×”×ª×¢×¨×‘×•×ª)", "×¡×™×›×•×Ÿ ×”×•×œ×›×™ ×¨×’×œ"],
        "10. × ×ª×™×‘ ×”××¦×”/×”××˜×”": ["×›× ×™×¡×” ×œ× ×–×”×™×¨×” ×× ×ª×™×‘ ×”××¦×”", "×‘×œ×™××” ×‘× ×ª×™×‘ × ×¡×™×¢×” ×œ×¤× ×™ × ×ª×™×‘ ×”××˜×”"],
        "11. × ×”×™×’×” ×‘×“×¨×š ×¦×¨×”": [
            "× ×™×¡×™×•×Ÿ ×¤× ×™×” ×©×××œ×” ×œ× ×ª×™×‘ × ×’×“×™ ×‘×“×¨×š ×¦×¨×” (×”×ª×¢×¨×‘×•×ª)",
            "×—×•×¡×¨ ×–×”×™×¨×•×ª ×‘××¤×’×© ×¢× ×¨×›×‘ ×××•×œ"
        ],
        "12. ×›×‘×™×© ×¨×˜×•×‘": ["× ×¡×™×¢×” ××”×™×¨×” ××™×“×™ ×œ×ª× ××™ ×”××—×™×–×”"]
    };

    const dataA = Object.keys(reasonsDB).slice(0, 15);
    const dataB = Object.keys(reasonsDB).slice(15, 27);
    const dataC = Object.keys(reasonsDB).slice(27);

    // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª ×”×¢××•×“×•×ª
    function renderColumn(id, list) {
        const container = document.getElementById(id);
        list.forEach(item => {
            const div = document.createElement('div');
            div.className = 'row-item';
            
            // ×™×¦×™×¨×ª ×¨×©×™××ª ×”×¡×™×‘×•×ª
            let options = `<option value="">×‘×—×¨ ×¤×™×¨×•×˜...</option>`;
            if (reasonsDB[item]) {
                reasonsDB[item].forEach(reason => {
                    options += `<option value="${reason}">${reason}</option>`;
                });
            }

            div.innerHTML = `
                <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
                    <span class="label-text">${item}</span>
                    <select class="reason-select" id="reason-${item}" onchange="updateNotes()">
                        ${options}
                        <option value="××—×¨">×”×§×œ×“×” ×™×“× ×™×ª / ××—×¨</option>
                    </select>
                </div>
                <select class="score-select no-print" onchange="markIcon(this)">
                    <option value="">×‘×—×¨</option>
                    <option value="v">×˜×•×‘ (âœ“)</option>
                    <option value="x">×¨×¢ (X)</option>
                    <option value="ox">×”×¤×§×¢×” (âŠ—)</option>
                </select>
                <div class="visual-box"></div>
            `;
            container.appendChild(div);
        });
    }

    function markIcon(sel) {
        const box = sel.nextElementSibling;
        const rowItem = sel.parentElement;
        const reasonSelect = rowItem.querySelector('.reason-select');
        
        const val = sel.value;
        box.innerHTML = '';
        
        if (val === 'v') {
            box.innerHTML = '<span class="v-mark">âœ“</span>';
            reasonSelect.style.display = 'none';
            reasonSelect.value = "";
        }
        else if (val === 'x') {
            box.innerHTML = '<span class="x-mark">âœ•</span>';
            reasonSelect.style.display = 'block';
        }
        else if (val === 'ox') {
            box.innerHTML = '<div class="ox-mark">âœ•</div>';
            reasonSelect.style.display = 'block';
        } else {
            reasonSelect.style.display = 'none';
            reasonSelect.value = "";
        }
        updateNotes();
    }

    function autoResize(textarea) {
        textarea.style.height = 'auto'; 
        textarea.style.height = (textarea.scrollHeight + 5) + 'px'; 
    }

    // ×¤×•× ×§×¦×™×” ×©×‘×•× ×” ××ª ×”×”×¢×¨×•×ª ×”×¡×•×¤×™×•×ª
    function updateNotes() {
        const selects = document.querySelectorAll('.reason-select');
        let notesText = "";
        
        selects.forEach(sel => {
            if (sel.style.display !== 'none' && sel.value && sel.value !== "") {
                const rawLabel = sel.parentElement.querySelector('.label-text').innerText;
                const cleanLabel = rawLabel.replace(/^\d+\.\s*/, ''); 
                const reason = sel.value;
                
                if (reason === "××—×¨") {
                    notesText += `â€¢ ${cleanLabel}: \n`;
                } else {
                    notesText += `â€¢ ${cleanLabel}: ${reason}\n`;
                }
            }
        });

        const notesArea = document.getElementById('finalNotes');
        notesArea.value = notesText;
        autoResize(notesArea);
    }

    // ×©×œ×™×—×” ×œ×•×•××˜×¡×¤
    function sendWhatsApp() {
        const nameFirst = document.getElementById('targetFirstName').value || '';
        const nameLast = document.getElementById('targetLastName').value || '';
        const fullName = `${nameFirst} ${nameLast}`;
        const notes = document.getElementById('finalNotes').value;
        
        if(!fullName.trim()) { alert('× × ×œ××œ× ×©× × ×‘×—×Ÿ'); return; }

        let msg = `*×ª×•×¦××•×ª ××‘×—×Ÿ × ×”×™×’×”*\n`;
        msg += `×©× ×”× ×‘×—×Ÿ: ${fullName}\n`;
        msg += `×ª×•×¦××”: *× ×›×©×œ*\n\n`;
        msg += `*×¤×™×¨×•×˜ ×”×œ×™×§×•×™×™×:*\n${notes}`;
        
        // ×™×¦×™×¨×ª ×§×™×©×•×¨ ×•×¤×ª×™×—×”
        const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
        window.open(url, '_blank');
    }

    renderColumn('colA', dataA);
    renderColumn('colB', dataB);
    renderColumn('colC', dataC);

    const canvas = document.getElementById('sig-canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    function getPos(e) {
        const r = canvas.getBoundingClientRect();
        return { 
            x: (e.clientX || e.touches[0].clientX) - r.left, 
            y: (e.clientY || e.touches[0].clientY) - r.top 
        };
    }

    ['mousedown', 'touchstart'].forEach(evt => 
        canvas.addEventListener(evt, e => { drawing = true; ctx.beginPath(); ctx.moveTo(getPos(e).x, getPos(e).y); if(evt=='touchstart') e.preventDefault(); })
    );
    ['mousemove', 'touchmove'].forEach(evt => 
        canvas.addEventListener(evt, e => { if(!drawing)return; ctx.lineTo(getPos(e).x, getPos(e).y); ctx.stroke(); if(evt=='touchmove') e.preventDefault(); })
    );
    ['mouseup', 'touchend'].forEach(evt => canvas.addEventListener(evt, () => drawing = false));

    function clearSig() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function updatePageTitle() {
        const first = document.getElementById('targetFirstName').value;
        const last = document.getElementById('targetLastName').value;
        if(first || last) {
            document.title = "×›×™×©×œ×•×Ÿ - " + first + " " + last;
        }
    }

    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('school')) document.getElementById('targetSchool').value = urlParams.get('school');
        if(urlParams.has('id')) document.getElementById('targetID').value = urlParams.get('id');
        if(urlParams.has('car')) document.getElementById('targetCar').value = urlParams.get('car');
        if(urlParams.has('date')) document.getElementById('targetDate').value = urlParams.get('date');
        if(urlParams.has('time')) document.getElementById('targetTime').value = urlParams.get('time');
        if(urlParams.has('tester')) document.getElementById('targetTester').value = urlParams.get('tester');

        if(urlParams.has('name')) {
            const fullName = urlParams.get('name').trim();
            const firstSpaceIndex = fullName.indexOf(' ');
            if (firstSpaceIndex > 0) {
                document.getElementById('targetFirstName').value = fullName.substring(0, firstSpaceIndex);
                document.getElementById('targetLastName').value = fullName.substring(firstSpaceIndex + 1);
            } else {
                document.getElementById('targetFirstName').value = fullName;
            }
            updatePageTitle();
        }
    };
</script>

</body>
</html>